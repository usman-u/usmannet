kind: pipeline
type: docker
name: USMAN.NET CI/CD

steps:
- name: discord notification start
  image: appleboy/drone-discord
  settings:
    webhook_id: 
      from_secret: discord_webhook_id
    webhook_token: 
      from_secret: discord_webhook_token

    message: >
      Event:  {{ build.event }}
      Status: {{ build.status }}
      Repo:   {{ build.name }} {{ build.author}}
      Author: {{ build.author }}
      Started:{{ build.started }}
      Link:   {{ build.link }} 
      
      

- name: Install and deploy
  image: python
  commands:
  - pip3 install -r requirements.txt
  - python3 main.py

- name: discord notification end
  image: appleboy/drone-discord
  settings:
    webhook_id: 
      from_secret: discord_webhook_id
    webhook_token: 
      from_secret: discord_webhook_token

    message: > 
      {{# success build.status }}
        build {{ build.number }} succeded. Nice.
      {{ else }}
        build {{build.number }} Failed. Not Nice.
      {{ /success }}
      Build Finished {{ build.finished }}

trigger:
  branch:
    exclude:
    - pull_request
